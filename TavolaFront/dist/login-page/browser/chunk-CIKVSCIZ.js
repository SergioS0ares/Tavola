import{a as W,b as J,c as G,d as K}from"./chunk-YFP5L56O.js";import{a as X,b as Z,c as te}from"./chunk-UCU2OXKO.js";import{b as R,d as z,e as D,f as Q,g as N,i as F}from"./chunk-PHAKSYZK.js";import{a as $}from"./chunk-IEUZODQR.js";import{f as Y}from"./chunk-MJD3AUS3.js";import{a as ee}from"./chunk-TOQIOME5.js";import{p as U,q as j}from"./chunk-Q7PZSYDJ.js";import{V as E,m as q,r as I}from"./chunk-KZ2VZQWD.js";import{c as B,d as w,f as C,h as k}from"./chunk-FHD2U5CN.js";import{$ as b,Aa as l,Ac as T,Bc as i,Cc as O,Db as L,Jb as S,Rb as m,Tb as V,cc as t,dc as o,ec as v,fc as M,gc as x,ic as P,mb as A,na as d,oc as g,qb as u,qc as p,u as h,y,za as c}from"./chunk-ZBUSQTZT.js";function ne(s,H){if(s&1){let e=P();t(0,"app-search-bar",25),g("search",function(){c(e);let r=p();return l(r.onSearchSticky())})("cityInput",function(r){c(e);let a=p();return l(a.onCityInputSticky(r))})("selectCity",function(r){c(e);let a=p();return l(a.selectCitySticky(r))})("selectQuery",function(r){c(e);let a=p();return l(a.selectQuerySticky(r))})("cityBlur",function(r){c(e);let a=p();return l(a.onCityBlurSticky(r))}),o()}if(s&2){let e=p();m("@searchBarAnim",void 0)("citySuggestions",e.citySuggestions)("querySuggestions",e.querySuggestions)("showCityDropdown",e.showCityDropdown)("showQueryDropdown",e.showQueryDropdown)("cityCtrl",e.cityCtrl)("queryCtrl",e.queryCtrl)}}function oe(s,H){s&1&&(M(0),t(1,"button",26)(2,"mat-icon"),i(3,"home"),o(),t(4,"span"),i(5,"In\xEDcio"),o()(),t(6,"button",27)(7,"mat-icon"),i(8,"history"),o(),t(9,"span"),i(10,"Hist\xF3rico"),o()(),x())}function re(s,H){s&1&&(M(0),t(1,"button",28)(2,"mat-icon"),i(3,"event"),o(),t(4,"span"),i(5,"Reservas"),o()(),t(6,"button",29)(7,"mat-icon"),i(8,"restaurant"),o(),t(9,"span"),i(10,"Meu Restaurante"),o()(),t(11,"button",30)(12,"mat-icon"),i(13,"menu_book"),o(),t(14,"span"),i(15,"Card\xE1pio"),o()(),x())}var Oe=(()=>{class s{constructor(){this.sidebarAberta=!0,this.showStickySearchBar=!1,this.cidade="",this.query="",this.citySuggestions=[],this.querySuggestions=[],this.showCityDropdown=!1,this.showQueryDropdown=!1,this.cityCtrl=new E(""),this.queryCtrl=new E(""),this.filteredCities$=h([]),this.filteredQueries$=h([]),this.currentHomeComponent=null,this.router=d(D),this.auth=d($),this.stickyService=d(X),this.restauranteService=d(ee),this.stickyService.sticky$.subscribe(e=>{let n=this.router.url.startsWith("/home");this.showStickySearchBar=e&&n,this.showStickySearchBar&&this.currentHomeComponent&&(this.cityCtrl.setValue(this.currentHomeComponent.cityCtrl.value,{emitEvent:!1}),this.queryCtrl.setValue(this.currentHomeComponent.queryCtrl.value,{emitEvent:!1}))}),this.router.events.subscribe(e=>{e instanceof R&&(this.router.url.startsWith("/home")||(this.showStickySearchBar=!1,this.currentHomeComponent=null))}),this.filteredCities$=this.cityCtrl.valueChanges.pipe(b(this.cityCtrl.value??""),y(e=>this._filter(e??"",this.citySuggestions))),this.filteredQueries$=this.queryCtrl.valueChanges.pipe(b(""),y(e=>this._filter(e??"",this.querySuggestions))),this.restauranteService.allCities$.subscribe(e=>{this.citySuggestions=e}),this.restauranteService.allCuisines$.subscribe(e=>{this.querySuggestions=e})}ngOnInit(){this.stickyService.setSidebarAberta(this.sidebarAberta)}get userName(){return this.auth.perfil?.nome||"Usu\xE1rio"}get userType(){return this.auth.perfil?.tipo==="RESTAURANTE"?"Restaurante":"Cliente"}get userAvatar(){let e=this.auth.perfil?.imagem;return e?this.auth.getAbsoluteImageUrl(e):this.auth.perfil?.tipo==="RESTAURANTE"?"assets/png/avatar-padrao-restaurante-tavola.png":"assets/png/avatar-padrao-tavola-cordeirinho.png"}get isCliente(){return this.auth.hasRole("CLIENTE")}get isRestaurante(){return this.auth.hasRole("RESTAURANTE")}handleSidebarClick(e){e.target.closest("button")||this.sidebarAberta||(this.sidebarAberta=!0,this.stickyService.setSidebarAberta(!0))}toggleSidebar(){this.sidebarAberta=!this.sidebarAberta,this.stickyService.setSidebarAberta(this.sidebarAberta)}logout(){this.auth.clearAuthData(),this.router.navigate(["/login"])}onSearchSticky(){console.log("Sticky Search - In\xEDcio"),console.log("Sticky Search - Buscar:",this.cityCtrl.value,this.queryCtrl.value);let e=this.router.url,n=this.currentHomeComponent!==null;console.log("Sticky Search - Rota atual:",e,"Est\xE1 na Home (componente ativo):",n),console.log("Sticky Search - currentHomeComponent (antes da busca):",this.currentHomeComponent),n?(console.log("Sticky Search - J\xE1 na rota /home e componente ativo. Sincronizando e buscando diretamente."),this.currentHomeComponent.cityCtrl.setValue(this.cityCtrl.value,{emitEvent:!1}),this.currentHomeComponent.queryCtrl.setValue(this.queryCtrl.value,{emitEvent:!1}),this.currentHomeComponent.onSearch(),console.log("Sticky Search - onSearch do HomeComponent acionado diretamente.")):(console.log("Sticky Search - N\xE3o est\xE1 na Home (componente ativo). Navegando para /home..."),this.router.navigate(["/home"]).then(()=>{setTimeout(()=>{this.currentHomeComponent?(console.log("Sticky Search - HomeComponent ativo ap\xF3s navega\xE7\xE3o. Sincronizando e buscando..."),this.currentHomeComponent.cityCtrl.setValue(this.cityCtrl.value,{emitEvent:!1}),this.currentHomeComponent.queryCtrl.setValue(this.queryCtrl.value,{emitEvent:!1}),this.currentHomeComponent.onSearch(),console.log("Sticky Search - onSearch do HomeComponent acionado.")):console.error("Sticky Search - HomeComponent ainda n\xE3o dispon\xEDvel ap\xF3s navega\xE7\xE3o. Tentar novamente ou avisar usu\xE1rio.")},200)}))}onCityInputSticky(e){if(this.currentHomeComponent){let n=e.target.value;this.citySuggestions=this._filter(n,this.citySuggestions),this.filteredCities$=h(this.citySuggestions),this.currentHomeComponent.cityCtrl.setValue(n,{emitEvent:!1})}}selectCitySticky(e){this.cityCtrl.setValue(e),this.currentHomeComponent&&this.currentHomeComponent.selectCity(e)}selectQuerySticky(e){this.queryCtrl.setValue(e),this.currentHomeComponent&&this.currentHomeComponent.selectQuery(e)}onCityBlurSticky(e){}get stickySearchBarClass(){return{"toolbar-search-bar":!0,"sidebar-fechada":!this.sidebarAberta}}_filter(e,n){let r=e.toLowerCase();return n.filter(a=>a.toLowerCase().includes(r))}onOutletActivate(e){console.log("onOutletActivate - Componente ativado:",e),e instanceof te?(console.log("onOutletActivate - Componente \xE9 HomeComponent."),this.currentHomeComponent=e,console.log("onOutletActivate - currentHomeComponent definido:",this.currentHomeComponent),this.currentHomeComponent.cityCtrl.valueChanges.subscribe(n=>{this.showStickySearchBar&&(this.cityCtrl.setValue(n||"",{emitEvent:!1}),console.log("onOutletActivate - cityCtrl da Sticky Search atualizado:",n))}),this.currentHomeComponent.queryCtrl.valueChanges.subscribe(n=>{this.showStickySearchBar&&(this.queryCtrl.setValue(n||"",{emitEvent:!1}),console.log("onOutletActivate - queryCtrl da Sticky Search atualizado:",n))}),this.citySuggestions=this.currentHomeComponent.todasCidades,this.querySuggestions=this.currentHomeComponent.todasCozinhas,console.log("onOutletActivate - Sugest\xF5es de cidades e cozinhas sincronizadas.")):(this.currentHomeComponent=null,console.log("onOutletActivate - Componente N\xC3O \xE9 HomeComponent. currentHomeComponent nulo."))}static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275cmp=L({type:s,selectors:[["app-layout-principal"]],decls:44,vars:9,consts:[["menu","matMenu"],[1,"layout-container"],[1,"toolbar"],[1,"menu-toggle",3,"click"],["class","toolbar-search-bar",3,"citySuggestions","querySuggestions","showCityDropdown","showQueryDropdown","cityCtrl","queryCtrl","search","cityInput","selectCity","selectQuery","cityBlur",4,"ngIf"],[1,"user-menu",3,"matMenuTriggerFor"],[1,"user-info"],[1,"avatar"],["alt","Avatar do usu\xE1rio",3,"src"],[1,"user-details"],[1,"user-name"],[1,"user-type"],[1,"user-dropdown"],["mat-menu-item","","routerLink","/configuracoes"],["mat-menu-item","",3,"click"],[1,"main-wrapper"],[1,"sidebar",3,"click"],[1,"sidebar-header"],["src","assets/png/LogoTavolaSimples.png","alt","Logo Tavola",1,"logo"],[1,"menu"],[4,"ngIf"],["routerLink","/configuracoes","routerLinkActive","active"],[1,"content"],[1,"router-container"],[3,"activate"],[1,"toolbar-search-bar",3,"search","cityInput","selectCity","selectQuery","cityBlur","citySuggestions","querySuggestions","showCityDropdown","showQueryDropdown","cityCtrl","queryCtrl"],["routerLink","/home","routerLinkActive","active"],["routerLink","/historico","routerLinkActive","active"],["routerLink","/reserva","routerLinkActive","active"],["routerLink","/meu-restaurante","routerLinkActive","active"],["routerLink","/cadastro-cardapio","routerLinkActive","active"]],template:function(n,r){if(n&1){let a=P();t(0,"div",1)(1,"div",2)(2,"button",3),g("click",function(){return c(a),l(r.toggleSidebar())}),t(3,"mat-icon"),i(4,"menu"),o()(),S(5,ne,1,7,"app-search-bar",4),t(6,"div",5)(7,"div",6)(8,"div",7),v(9,"img",8),o(),t(10,"div",9)(11,"span",10),i(12),o(),t(13,"span",11),i(14),o()()(),t(15,"mat-icon"),i(16,"keyboard_arrow_down"),o()(),t(17,"mat-menu",12,0)(19,"button",13)(20,"mat-icon"),i(21,"settings"),o(),t(22,"span"),i(23,"Configura\xE7\xF5es"),o()(),t(24,"button",14),g("click",function(){return c(a),l(r.logout())}),t(25,"mat-icon"),i(26,"logout"),o(),t(27,"span"),i(28,"Sair"),o()()()(),t(29,"div",15)(30,"div",16),g("click",function(f){return c(a),l(r.handleSidebarClick(f))}),t(31,"div",17),v(32,"img",18),o(),t(33,"div",19),S(34,oe,11,0,"ng-container",20)(35,re,16,0,"ng-container",20),t(36,"button",21)(37,"mat-icon"),i(38,"settings"),o(),t(39,"span"),i(40,"Configura\xE7\xF5es"),o()()()(),t(41,"div",22)(42,"div",23)(43,"router-outlet",24),g("activate",function(f){return c(a),l(r.onOutletActivate(f))}),o()()()()()}if(n&2){let a=T(18);u(5),m("ngIf",r.showStickySearchBar),u(),m("matMenuTriggerFor",a),u(3),m("src",r.userAvatar,A),u(3),O(r.userName),u(2),O(r.userType),u(16),V("fechada",!r.sidebarAberta),u(4),m("ngIf",r.isCliente),u(),m("ngIf",r.isRestaurante)}},dependencies:[z,F,Q,N,j,U,Y,K,J,W,G,I,q,Z],styles:[".layout-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100vh}.toolbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:0 16px;height:60px;background-color:#c22523;color:#fff;z-index:10}.toolbar[_ngcontent-%COMP%]   .menu-toggle[_ngcontent-%COMP%]{background:transparent;border:none;color:#fff;cursor:pointer}.toolbar[_ngcontent-%COMP%]   .menu-toggle[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px}.toolbar[_ngcontent-%COMP%]   .user-menu[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;cursor:pointer;padding:4px 8px;border-radius:4px;transition:background-color .2s}.toolbar[_ngcontent-%COMP%]   .user-menu[_ngcontent-%COMP%]:hover{background-color:#ffffff1a}.toolbar[_ngcontent-%COMP%]   .user-menu[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.toolbar[_ngcontent-%COMP%]   .user-menu[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;overflow:hidden;border:2px solid #F6BD38}.toolbar[_ngcontent-%COMP%]   .user-menu[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.toolbar[_ngcontent-%COMP%]   .user-menu[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]{display:flex;flex-direction:column}.toolbar[_ngcontent-%COMP%]   .user-menu[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .user-name[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:#fff}.toolbar[_ngcontent-%COMP%]   .user-menu[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .user-type[_ngcontent-%COMP%]{font-size:12px;color:#fffc}.toolbar[_ngcontent-%COMP%]   .user-menu[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#fffc}.main-wrapper[_ngcontent-%COMP%]{flex:1;display:flex;overflow:hidden;background-color:#ebe8e2}.sidebar[_ngcontent-%COMP%]{margin:16px;width:240px;background-color:#3b221b;color:#fff;border-radius:16px;box-shadow:0 4px 12px #0000004d;padding:16px;display:flex;flex-direction:column;transition:all .3s ease;cursor:pointer}.sidebar.fechada[_ngcontent-%COMP%]{width:70px;padding:16px 8px}.sidebar.fechada[_ngcontent-%COMP%]   .sidebar-header[_ngcontent-%COMP%]{justify-content:center}.sidebar.fechada[_ngcontent-%COMP%]   .sidebar-header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{width:30px}.sidebar.fechada[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{justify-content:center}.sidebar.fechada[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:none}.sidebar[_ngcontent-%COMP%]   .sidebar-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.sidebar[_ngcontent-%COMP%]   .sidebar-header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{width:50px;height:auto}.sidebar[_ngcontent-%COMP%]   .sidebar-header[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{background:none;border:none;color:#fff;font-size:24px;cursor:pointer}.sidebar[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.sidebar[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;background:transparent;border:1px solid #F6BD38;color:#f6bd38;padding:12px 16px;border-radius:10px;cursor:pointer;font-weight:500;width:100%;transition:all .2s ease;box-sizing:border-box}.sidebar[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px}.sidebar[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover, .sidebar[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background-color:#f6bd38;color:#3b221b;border:1px solid #F6BD38}.content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.content[_ngcontent-%COMP%]   .router-container[_ngcontent-%COMP%]{flex:1;padding:24px;background-color:#ebe8e2;overflow-y:auto}.menu-toggle[_ngcontent-%COMP%]{background:transparent;border:none;color:#fff;cursor:pointer;font-size:24px}  .user-dropdown{margin-top:8px}  .user-dropdown .mat-mdc-menu-content{padding:0}  .user-dropdown .mat-mdc-menu-item{display:flex;align-items:center;gap:8px;padding:12px 16px}  .user-dropdown .mat-mdc-menu-item mat-icon{margin:0}.toolbar-search-bar[_ngcontent-%COMP%]{flex:1;max-width:700px;margin:0 32px;align-self:center;z-index:20;transition:margin-left .3s,box-shadow .3s,transform .3s}.sidebar-fechada[_ngcontent-%COMP%]{margin-left:0!important}@media (min-width: 900px){.toolbar-search-bar[_ngcontent-%COMP%]{margin-left:80px}.sidebar-fechada.toolbar-search-bar[_ngcontent-%COMP%]{margin-left:0}}.toolbar-search-bar[_ngcontent-%COMP%]{opacity:1;transform:translateY(0);transition:opacity .3s,transform .3s}[_nghost-%COMP%]     .toolbar-search-bar.ng-animating{opacity:0;transform:translateY(-30px)}@media (max-width: 900px){.toolbar-search-bar[_ngcontent-%COMP%]{max-width:98vw;margin:0 8px}}.toolbar-search-bar[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .toolbar-search-bar[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%], .toolbar-search-bar[_ngcontent-%COMP%]   .brown[_ngcontent-%COMP%]{color:#3b221b!important}"],data:{animation:[B("searchBarAnim",[k(":enter",[C({opacity:0,transform:"translateY(-30px)"}),w("300ms",C({opacity:1,transform:"translateY(0)"}))]),k(":leave",[w("300ms",C({opacity:0,transform:"translateY(-30px)"}))])])]}})}}return s})();export{Oe as a};
