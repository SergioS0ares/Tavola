{
  "version": 3,
  "sources": ["src/app/core/services/auth.service.ts"],
  "sourcesContent": ["// auth.service.ts\r\nimport { Injectable } from '@angular/core';\r\n\r\nexport interface Perfil {\r\n  tipo: 'CLIENTE' | 'RESTAURANTE';\r\n  nome: string;\r\n  id?: string;\r\n  imagem?: string | null;\r\n}\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class AuthService {\r\n  private readonly TOKEN_KEY = 'token';\r\n  private readonly USER_NAME_KEY = 'nome';\r\n  private readonly USER_TYPE_KEY = 'tipoUsuario';\r\n  private readonly RESTAURANTE_ID_KEY = 'idRestaurante';\r\n  private readonly USER_IMAGE_KEY = 'imagemUsuario';\r\n\r\n  private _token: string | null = null;\r\n  private _perfil: Perfil | null = null;\r\n  private readonly BASE_IMAGE_URL = 'http://localhost:8080';\r\n\r\n  constructor() {\r\n    this._token = localStorage.getItem(this.TOKEN_KEY);\r\n    const nome = localStorage.getItem(this.USER_NAME_KEY);\r\n    const tipo = localStorage.getItem(this.USER_TYPE_KEY) as 'CLIENTE' | 'RESTAURANTE' | null;\r\n    const id = localStorage.getItem(this.RESTAURANTE_ID_KEY) || undefined;\r\n    const imagem = localStorage.getItem(this.USER_IMAGE_KEY) || undefined;\r\n  \r\n    if (nome && tipo) {\r\n      this._perfil = { nome, tipo, id, imagem };\r\n    }\r\n    console.log('[AuthService] Constructor - perfil inicial:', this._perfil);\r\n  }\r\n\r\n  setAuthData(token: string, nome: string, tipoUsuario: 'CLIENTE' | 'RESTAURANTE', id?: string, imagem?: string | null) {\r\n    this.setToken(token);\r\n    this.setPerfil({ nome, tipo: tipoUsuario, id, imagem });\r\n    localStorage.setItem(this.TOKEN_KEY, token);\r\n    localStorage.setItem(this.USER_NAME_KEY, nome);\r\n    localStorage.setItem(this.USER_TYPE_KEY, tipoUsuario);\r\n    if (id && tipoUsuario === 'RESTAURANTE') {\r\n       localStorage.setItem(this.RESTAURANTE_ID_KEY, id);\r\n    }\r\n    if (imagem) {\r\n        localStorage.setItem(this.USER_IMAGE_KEY, imagem);\r\n    } else {\r\n        localStorage.removeItem(this.USER_IMAGE_KEY);\r\n    }\r\n  }\r\n\r\n  setToken(token: string) {\r\n    this._token = token;\r\n    localStorage.setItem(this.TOKEN_KEY, token);\r\n  }\r\n\r\n  getToken(): string | null {\r\n    return localStorage.getItem(this.TOKEN_KEY);\r\n  }\r\n\r\n  setPerfil(perfil: Perfil) {\r\n    this._perfil = perfil;\r\n    localStorage.setItem(this.USER_NAME_KEY, perfil.nome);\r\n    localStorage.setItem(this.USER_TYPE_KEY, perfil.tipo);\r\n    if (perfil.tipo === 'RESTAURANTE' && perfil.id) {\r\n        localStorage.setItem(this.RESTAURANTE_ID_KEY, perfil.id);\r\n    }\r\n    if (perfil.imagem) {\r\n        localStorage.setItem(this.USER_IMAGE_KEY, perfil.imagem);\r\n    } else {\r\n        localStorage.removeItem(this.USER_IMAGE_KEY);\r\n    }\r\n  }\r\n\r\n  get perfil(): Perfil | null {\r\n    if (this._perfil) {\r\n      return this._perfil;\r\n    }\r\n    \r\n    const nome = localStorage.getItem(this.USER_NAME_KEY);\r\n    const tipo = localStorage.getItem(this.USER_TYPE_KEY) as 'CLIENTE' | 'RESTAURANTE' | null;\r\n    const id = localStorage.getItem(this.RESTAURANTE_ID_KEY) || undefined;\r\n    const imagem = localStorage.getItem(this.USER_IMAGE_KEY) || undefined;\r\n    \r\n    if (nome && tipo && this.getToken()) {\r\n      this._perfil = { nome, tipo, id, imagem };\r\n  \r\n      return this._perfil;\r\n    }\r\n   \r\n    return null;\r\n  }\r\n\r\n  clearAuthData() {\r\n    this._token = null;\r\n    this._perfil = null;\r\n    localStorage.removeItem(this.TOKEN_KEY);\r\n    localStorage.removeItem(this.USER_NAME_KEY);\r\n    localStorage.removeItem(this.USER_TYPE_KEY);\r\n    localStorage.removeItem(this.RESTAURANTE_ID_KEY);\r\n    localStorage.removeItem(this.USER_IMAGE_KEY);\r\n  }\r\n\r\n  hasRole(role: 'CLIENTE' | 'RESTAURANTE'): boolean {\r\n    return this.perfil?.tipo === role;\r\n  }\r\n\r\n  getAbsoluteImageUrl(relativePath: string | null | undefined): string {\r\n    if (relativePath) {\r\n      return `${this.BASE_IMAGE_URL}${relativePath}`;\r\n    }\r\n    return '';\r\n  }\r\n}"],
  "mappings": "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",
  "names": []
}
