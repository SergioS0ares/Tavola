{
  "version": 3,
  "sources": ["src/app/core/services/login.service.ts"],
  "sourcesContent": ["import { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { LoginResponse } from '../../types/login-response.type';\r\nimport { Observable, tap } from 'rxjs';\r\nimport { AuthService } from './auth.service';\r\nimport { RefreshResponse } from '../../types/refresh-token.type';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class LoginService {\r\n  apiUrl: string = \"http://localhost:8080/auth\";\r\n\r\n  constructor(private httpClient: HttpClient, private auth: AuthService) {}\r\n\r\n  login(email: string, senha: string): Observable<LoginResponse> {\r\n    return this.httpClient.post<LoginResponse>(`${this.apiUrl}/login`, { email, senha }, { withCredentials: true }).pipe(\r\n      tap((value) => {\r\n        this.auth.setToken(value.token);\r\n        this.auth.setPerfil({ tipo: value.tipoUsuario, nome: value.nome, imagem: value.imagem });\r\n      })\r\n    );\r\n  }\r\n\r\n  signup(data: any): Observable<LoginResponse> {\r\n    return this.httpClient.post<LoginResponse>(`${this.apiUrl}/register`, data, { withCredentials: true }).pipe(\r\n      tap((value) => {\r\n        this.auth.setToken(value.token);\r\n        this.auth.setPerfil({ tipo: value.tipoUsuario, nome: value.nome, imagem: value.imagem });\r\n      })\r\n    );\r\n  }\r\n\r\n  refreshToken(): Observable<LoginResponse> {\r\n    console.log('[LoginService] calling /auth/refresh');\r\n    return this.httpClient\r\n      .post<LoginResponse>(`${this.apiUrl}/refresh`, {}, { withCredentials: true })\r\n      .pipe(\r\n        tap(res => {\r\n          console.log('[LoginService] refresh response received:', res);\r\n          // atualiza token na AuthService\r\n          this.auth.setToken(res.token);\r\n          // se precisar atualizar perfil:\r\n          this.auth.setPerfil({ tipo: res.tipoUsuario, nome: res.nome, imagem: res.imagem });\r\n        })\r\n      );\r\n  }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;AAUM,IAAO,eAAP,MAAO,cAAY;EAGvB,YAAoB,YAAgC,MAAiB;AAAjD,SAAA,aAAA;AAAgC,SAAA,OAAA;AAFpD,SAAA,SAAiB;EAEuD;EAExE,MAAM,OAAe,OAAa;AAChC,WAAO,KAAK,WAAW,KAAoB,GAAG,KAAK,MAAM,UAAU,EAAE,OAAO,MAAK,GAAI,EAAE,iBAAiB,KAAI,CAAE,EAAE,KAC9G,IAAI,CAAC,UAAS;AACZ,WAAK,KAAK,SAAS,MAAM,KAAK;AAC9B,WAAK,KAAK,UAAU,EAAE,MAAM,MAAM,aAAa,MAAM,MAAM,MAAM,QAAQ,MAAM,OAAM,CAAE;IACzF,CAAC,CAAC;EAEN;EAEA,OAAO,MAAS;AACd,WAAO,KAAK,WAAW,KAAoB,GAAG,KAAK,MAAM,aAAa,MAAM,EAAE,iBAAiB,KAAI,CAAE,EAAE,KACrG,IAAI,CAAC,UAAS;AACZ,WAAK,KAAK,SAAS,MAAM,KAAK;AAC9B,WAAK,KAAK,UAAU,EAAE,MAAM,MAAM,aAAa,MAAM,MAAM,MAAM,QAAQ,MAAM,OAAM,CAAE;IACzF,CAAC,CAAC;EAEN;EAEA,eAAY;AACV,YAAQ,IAAI,sCAAsC;AAClD,WAAO,KAAK,WACT,KAAoB,GAAG,KAAK,MAAM,YAAY,CAAA,GAAI,EAAE,iBAAiB,KAAI,CAAE,EAC3E,KACC,IAAI,SAAM;AACR,cAAQ,IAAI,6CAA6C,GAAG;AAE5D,WAAK,KAAK,SAAS,IAAI,KAAK;AAE5B,WAAK,KAAK,UAAU,EAAE,MAAM,IAAI,aAAa,MAAM,IAAI,MAAM,QAAQ,IAAI,OAAM,CAAE;IACnF,CAAC,CAAC;EAER;;;uCApCW,eAAY,mBAAA,UAAA,GAAA,mBAAA,WAAA,CAAA;IAAA;EAAA;;4EAAZ,eAAY,SAAZ,cAAY,WAAA,YAFX,OAAM,CAAA;EAAA;;;sEAEP,cAAY,CAAA;UAHxB;WAAW;MACV,YAAY;KACb;;;",
  "names": []
}
