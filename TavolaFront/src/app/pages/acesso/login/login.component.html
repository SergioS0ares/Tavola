<app-default-login-layout>
    <!-- Tabs para alternar entre login normal e garçom -->
    <mat-tab-group [(selectedIndex)]="selectedTabIndex" class="login-tabs">
        <!-- Tab de Login Normal -->
        <mat-tab label="Cliente/Restaurante">
            <div class="form-section">
                <form [formGroup]="loginForm" class="login-form" (ngSubmit)="realizarLogin()">
                    <!-- Campo E-mail -->
                    <mat-form-field class="largura-total" appearance="outline" >
                        <mat-label>E-mail</mat-label>
                        <span matPrefix>
                            <mat-icon class="input-icon">email</mat-icon>
                        </span>
                        <input matInput placeholder="Seu e-mail" formControlName="email" type="email">

                        <!-- Priorizar o erro do TLD antes do erro padrão -->
                        <mat-error *ngIf="loginForm.get('email')?.hasError('emailTLD')">
                            Insira um email válido com um domínio (ex: .com)
                        </mat-error>
                        <mat-error *ngIf="loginForm.get('email')?.hasError('email') && !loginForm.get('email')?.hasError('emailTLD')">
                            Email inválido
                        </mat-error>
                        <mat-error *ngIf="loginForm.get('email')?.hasError('required') && !loginForm.get('email')?.hasError('emailTLD') && !loginForm.get('email')?.hasError('email')">
                            Este campo é obrigatório
                        </mat-error>
                    </mat-form-field>

                    <!-- Campo Senha -->
                    <mat-form-field class="largura-total" appearance="outline">
                        <mat-label>Senha</mat-label>
                        <span matPrefix>
                            <mat-icon class="input-icon">lock</mat-icon>
                        </span>
                        <input matInput placeholder="Sua senha" formControlName="senha" [type]="hidePassword ? 'password' : 'text'">
                        <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword" type="button">
                            <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
                        </button>
                        <mat-error *ngIf="loginForm.get('senha')?.hasError('required')">
                            Este campo é obrigatório
                        </mat-error>
                    </mat-form-field>
                    
                    <!-- Link Esqueci Minha Senha -->
                    <div class="forgot-password">
                        <a href="#" (click)="forgotPassword(); $event.preventDefault();">Esqueci minha senha</a>
                    </div>
                    
                    <div *ngIf="showLoginError" class="login-error-card">
                        <mat-icon>error</mat-icon>
                        Não foi possível acessar sua conta. Verifique seu e-mail e senha e tente novamente.
                    </div>
                    
                    <div class="actions">
                        <button 
                          type="submit" 
                          class="primary-action" 
                          [disabled]="!loginForm.valid">
                          <i nz-icon nzType="login" nzTheme="outline"></i>
                          Entrar
                        </button>
                        
                        <button 
                          type="button"
                          class="secondary-action" 
                          (click)="irParaCadastro()">
                          <i nz-icon nzType="user-add" nzTheme="outline"></i>
                          Criar Conta
                        </button>
                    </div>
                </form>
            </div>
        </mat-tab>

        <!-- Tab de Login do Garçom -->
        <mat-tab label="Garçom">
            <div class="form-section">
                <form [formGroup]="garcomForm" class="login-form" (ngSubmit)="realizarLoginGarcom()">
                    <!-- Campo E-mail do Restaurante -->
                    <mat-form-field class="largura-total" appearance="outline">
                        <mat-label>E-mail do Restaurante</mat-label>
                        <span matPrefix>
                            <mat-icon class="input-icon">restaurant</mat-icon>
                        </span>
                        <input matInput placeholder="E-mail do restaurante" formControlName="emailRestaurante" type="email">
                        <mat-error *ngIf="garcomForm.get('emailRestaurante')?.hasError('required')">
                            Este campo é obrigatório
                        </mat-error>
                        <mat-error *ngIf="garcomForm.get('emailRestaurante')?.hasError('email')">
                            E-mail inválido
                        </mat-error>
                    </mat-form-field>

                    <!-- Campo Código de Identidade -->
                    <mat-form-field class="largura-total" appearance="outline">
                        <mat-label>Código de Identidade</mat-label>
                        <span matPrefix>
                            <mat-icon class="input-icon">badge</mat-icon>
                        </span>
                        <input matInput placeholder="Ex: 4511-2719" formControlName="codigoIdentidade">
                        <mat-error *ngIf="garcomForm.get('codigoIdentidade')?.hasError('required')">
                            Este campo é obrigatório
                        </mat-error>
                    </mat-form-field>

                    <!-- Campo Senha -->
                    <mat-form-field class="largura-total" appearance="outline">
                        <mat-label>Senha</mat-label>
                        <span matPrefix>
                            <mat-icon class="input-icon">lock</mat-icon>
                        </span>
                        <input matInput placeholder="Sua senha" formControlName="senha" [type]="hideGarcomPassword ? 'password' : 'text'">
                        <button mat-icon-button matSuffix (click)="hideGarcomPassword = !hideGarcomPassword" type="button">
                            <mat-icon>{{hideGarcomPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
                        </button>
                        <mat-error *ngIf="garcomForm.get('senha')?.hasError('required')">
                            Este campo é obrigatório
                        </mat-error>
                    </mat-form-field>
                    
                    <div *ngIf="showLoginError" class="login-error-card">
                        <mat-icon>error</mat-icon>
                        Não foi possível acessar. Verifique os dados e tente novamente.
                    </div>
                    
                    <div class="actions">
                        <button 
                          type="submit" 
                          class="primary-action" 
                          [disabled]="!garcomForm.valid">
                          <i nz-icon nzType="login" nzTheme="outline"></i>
                          Entrar como Garçom
                        </button>
                    </div>
                </form>
            </div>
        </mat-tab>
    </mat-tab-group>
</app-default-login-layout>
