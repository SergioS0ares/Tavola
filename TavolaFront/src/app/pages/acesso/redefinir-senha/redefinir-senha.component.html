<app-default-login-layout title="Redefinir sua Senha">
  <div class="form-section">
    <div *ngIf="isLoading" class="status-card">
      <mat-icon>hourglass_empty</mat-icon>
      <p>Validando seu acesso, por favor aguarde...</p>
    </div>

    <div *ngIf="!isLoading && !isTokenValid" class="status-card error">
      <mat-icon>error</mat-icon>
      <p>{{ errorMessage }}</p>
      <p>Você será redirecionado para a tela de login.</p>
    </div>

    <form *ngIf="!isLoading && isTokenValid" [formGroup]="resetForm" class="reset-form" (ngSubmit)="onSubmit()">
      <p class="form-description">
        Crie uma nova senha. Ela deve ter no mínimo 6 caracteres.
      </p>

      <mat-form-field appearance="outline">
        <mat-label>Nova Senha</mat-label>
        <input matInput formControlName="novaSenha" [type]="hidePassword ? 'password' : 'text'">
        <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword" type="button">
          <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        <mat-error *ngIf="resetForm.get('novaSenha')?.hasError('required')">
          A nova senha é obrigatória.
        </mat-error>
        <mat-error *ngIf="resetForm.get('novaSenha')?.hasError('minlength')">
          A senha deve ter no mínimo 6 caracteres.
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Confirmar Nova Senha</mat-label>
        <input matInput formControlName="confirmarSenha" [type]="hideConfirmPassword ? 'password' : 'text'">
        <button mat-icon-button matSuffix (click)="hideConfirmPassword = !hideConfirmPassword" type="button">
          <mat-icon>{{hideConfirmPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        <mat-error *ngIf="resetForm.hasError('mismatch') && resetForm.get('confirmarSenha')?.touched">
          As senhas não coincidem.
        </mat-error>
        <mat-error *ngIf="resetForm.get('confirmarSenha')?.hasError('required')">
          A confirmação de senha é obrigatória.
        </mat-error>
      </mat-form-field>
      
      <div class="actions">
        <button type="submit" class="primary-action" [disabled]="!resetForm.valid">
          <i nz-icon nzType="key" nzTheme="outline"></i>
          Redefinir Senha
        </button>
      </div>
    </form>
  </div>
</app-default-login-layout>
