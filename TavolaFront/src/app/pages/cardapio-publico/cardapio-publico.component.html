<div class="cardapio-publico-container">
  <div class="header-publico">
    <img src="assets/png/LogoTavolaSimples.png" alt="Logo Tavola" class="logo-img">
    <div class="restaurante-header-info">
      <img *ngIf="imagemRestaurante" [src]="imagemRestaurante" [alt]="nomeRestaurante" class="restaurante-img">
      <h1 class="page-title">{{ nomeRestaurante }}</h1>
    </div>
  </div>

  <div *ngIf="isLoading" class="loading-spinner">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Carregando cardápio...</p>
  </div>

  <div *ngIf="hasError && !isLoading" class="error-state">
    <nz-empty nzNotFoundImage="error" nzNotFoundContent="Ocorreu um erro ao carregar o cardápio. Tente novamente mais tarde."></nz-empty>
  </div>

  <div *ngIf="!isLoading && !hasError && categorias.length === 0" class="empty-state">
    <nz-empty nzNotFoundContent="Este restaurante ainda não cadastrou itens no cardápio."></nz-empty>
  </div>

  <div *ngIf="!isLoading && !hasError && categorias.length > 0" class="menu-content-publico">
    <div class="menu-intro-publico">
      <h2>Experimente este menu</h2>
      <p>Explore a oferta gastronômica deste restaurante e deixe-se inspirar.</p>
      
      <div class="menu-info">
        <!-- Campo de Busca -->
        <div class="busca-menu-container">
          <mat-form-field appearance="outline" class="busca-menu-field">
            <mat-label>Buscar no cardápio</mat-label>
            <input matInput 
              [(ngModel)]="pesquisa" 
              (input)="aplicarFiltros()"
              placeholder="Digite o nome, descrição ou tag do item">
            <button mat-icon-button matSuffix *ngIf="pesquisa" (click)="limparPesquisa()" aria-label="Limpar busca">
              <mat-icon>close</mat-icon>
            </button>
            <button mat-icon-button matSuffix *ngIf="!pesquisa" aria-label="Buscar">
              <mat-icon>search</mat-icon>
            </button>
          </mat-form-field>
        </div>
        
        <!-- Opções Dietéticas - Estilo do Agendamento -->
        <div class="opcoes-dieteticas" (click)="openDietOptions()" *ngIf="dietOptions.length > 0">
          <i nz-icon nzType="check-circle" nzTheme="outline"></i>
          <div>
            <span>Opções dietéticas</span>
            <p>{{ dietOptions.join(', ') }}</p>
          </div>
          <i nz-icon nzType="right" nzTheme="outline"></i>
        </div>
        
        <!-- Botão de Filtros Avançados -->
        <div class="filtros-avancados-container">
          <button mat-icon-button 
                  class="filter-button" 
                  [matMenuTriggerFor]="filterMenu"
                  #filterMenuTrigger="matMenuTrigger"
                  matTooltip="Filtros avançados"
                  [matTooltipDisabled]="false">
            <mat-icon>tune</mat-icon>
          </button>
          
          <!-- Menu de filtros -->
          <mat-menu #filterMenu="matMenu" class="tavola-menu-bar" (menuClosed)="onMenuClosed($event)">
            <div class="filter-menu-content" (click)="$event.stopPropagation()">
              <div class="filter-header">
                <h4>Filtros</h4>
                <button mat-icon-button (click)="limparFiltros()" matTooltip="Limpar filtros">
                  <mat-icon>clear</mat-icon>
                </button>
              </div>
              
              <mat-form-field appearance="outline" class="filter-field">
                <mat-label>Categoria</mat-label>
                <mat-select [(ngModel)]="categoriaFiltro" (selectionChange)="aplicarFiltrosSemFechar()" (click)="$event.stopPropagation()">
                  <mat-option value="">Todas as categorias</mat-option>
                  <mat-option *ngFor="let categoria of categorias" [value]="categoria.nome" (click)="$event.stopPropagation()">
                    {{ categoria.nome }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              
              <mat-form-field appearance="outline" class="filter-field">
                <mat-label>Tags</mat-label>
                <mat-select [(ngModel)]="tagFiltro" (selectionChange)="aplicarFiltrosSemFechar()" multiple (click)="$event.stopPropagation()">
                  <mat-option *ngFor="let tag of tagsDisponiveis" [value]="tag" (click)="$event.stopPropagation()">
                    {{ tag }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              
              <div class="filter-options">
                <mat-checkbox [(ngModel)]="apenasDisponiveis" (change)="aplicarFiltrosSemFechar()" (click)="$event.stopPropagation()">
                  Apenas disponíveis
                </mat-checkbox>
              </div>
            </div>
          </mat-menu>
        </div>
      </div>
    </div>
    
    <!-- Categorias de navegação com setas e comportamento sticky -->
    <div #categoriasNavContainer class="categorias-nav-container">
      <div class="categorias-nav" [class.fixed]="categoriasFixas">
        <div class="categorias-wrapper">
          <!-- Seta Esquerda -->
          <button 
            class="nav-arrow left-arrow" 
            (click)="scrollCategorias('left')" 
            [class.hidden]="!mostrarSetaEsquerda">
            <i nz-icon nzType="left" nzTheme="outline"></i>
          </button>
          
          <!-- Container de Scroll -->
          <div class="categorias-scroll" #categoriasScrollContainer (scroll)="onCategoriaScroll($event)">
            <button 
              *ngFor="let categoria of categoriasFiltradas" 
              class="categoria-btn" 
              [class.active]="categoriaAtiva === categoria.nome"
              (click)="selecionarCategoria(categoria.nome)">
              {{ categoria.nome }}
            </button>
          </div>
          
          <!-- Seta Direita -->
          <button 
            class="nav-arrow right-arrow" 
            (click)="scrollCategorias('right')" 
            [class.hidden]="!mostrarSetaDireita">
            <i nz-icon nzType="right" nzTheme="outline"></i>
          </button>
        </div>
      </div>
    </div>

    <nz-image-group>
      <div class="categorias-content">
        <div *ngFor="let categoria of categoriasFiltradas" class="categoria-section" [id]="'categoria-' + categoria.nome.toLowerCase().replace(' ', '-')">
          <h3 class="categoria-titulo">{{ categoria.nome }}</h3>

          <div class="itens-lista">
            <div *ngFor="let item of categoria.itens" class="item-card">
              <div class="item-content">
                <div class="item-image" *ngIf="item.imagem">
                  <img nz-image [nzSrc]="item.imagem" [alt]="item.nome">
                </div>
                <div class="item-info">
                  <h4 class="item-nome">{{ item.nome }}</h4>
                  <p class="item-descricao" *ngIf="item.descricao">{{ item.descricao }}</p>
                  <div class="item-tags" *ngIf="item.tags && item.tags.length > 0">
                    <span *ngFor="let tag of item.tags" class="tag-chip">
                      {{ getTagName(tag) }}
                    </span>
                  </div>
                </div>
                <div class="item-preco">
                  {{ item.preco | currency:'BRL' }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </nz-image-group>
  </div>
  
  <!-- Mensagem quando não há resultados -->
  <div *ngIf="!isLoading && !hasError && categorias.length > 0 && categoriasFiltradas.length === 0" class="sem-resultados">
    <nz-empty nzNotFoundContent="Nenhum item encontrado com os filtros selecionados."></nz-empty>
  </div>
  
  <!-- Drawer de Opções Dietéticas -->
  <nz-drawer
    [nzVisible]="isDietOptionsVisible"
    nzPlacement="right"
    nzTitle="Opções dietéticas"
    (nzOnClose)="closeDietOptions()"
    [nzWidth]="'400px'"
    [nzMaskClosable]="true"
    class="opcoes-dieteticas-drawer-wrapper">
    
    <ng-container *nzDrawerContent>
      <p class="drawer-description">Este restaurante informou-nos que oferece pratos com as seguintes opções dietéticas:</p>
      <div class="opcoes-dieteticas-drawer">
        <div *ngFor="let opcao of dietOptions" class="opcao-item">
          <i nz-icon nzType="check" nzTheme="outline"></i>
          <span>{{ opcao }}</span>
        </div>
      </div>
    </ng-container>
  </nz-drawer>
</div>
