<div class="cardapio-publico-container">
  <!-- Novo hero header com imagem grande e overlay -->
  <div class="hero-header" *ngIf="!isLoading && !hasError">
    <div class="hero-background" [style.background-image]="imagemRestaurante ? 'url(' + imagemRestaurante + ')' : 'url(assets/jpg/placeholder-comida.jpg)'"></div>
    <div class="hero-overlay"></div>
    <div class="hero-content">
      <img src="assets/png/LogoTavolaSimples.png" alt="Logo Tavola" class="logo-img">
      <h1 class="restaurante-nome">{{ nomeRestaurante }}</h1>
      <p class="hero-subtitle">Descubra sabores extraordinários</p>
    </div>
    <div class="hero-scroll-indicator">
      <i nz-icon nzType="down" nzTheme="outline"></i>
    </div>
  </div>

  <!-- Loading e error states movidos para cima -->
  <div *ngIf="isLoading" class="loading-spinner">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Carregando cardápio...</p>
  </div>

  <div *ngIf="hasError && !isLoading" class="error-state">
    <nz-empty nzNotFoundImage="error" nzNotFoundContent="Ocorreu um erro ao carregar o cardápio. Tente novamente mais tarde."></nz-empty>
  </div>

  <div *ngIf="!isLoading && !hasError && categorias.length === 0" class="empty-state">
    <nz-empty nzNotFoundContent="Este restaurante ainda não cadastrou itens no cardápio."></nz-empty>
  </div>

  <div *ngIf="!isLoading && !hasError && categorias.length > 0" class="menu-content-publico">
    <!-- Nova seção de busca e filtros com design moderno -->
    <div class="search-section">
      <div class="search-container">
        <mat-form-field appearance="outline" class="search-field">
          <mat-icon matPrefix>search</mat-icon>
          <input matInput 
            [(ngModel)]="pesquisa" 
            (input)="aplicarFiltros()"
            placeholder="Buscar pratos, ingredientes...">
          <button mat-icon-button matSuffix *ngIf="pesquisa" (click)="limparPesquisa()">
            <mat-icon>close</mat-icon>
          </button>
        </mat-form-field>

        <div class="filter-chips">
          <button mat-stroked-button 
                  class="filter-chip"
                  [class.active]="dietOptions.length > 0"
                  (click)="openDietOptions()" 
                  *ngIf="dietOptions.length > 0"
                  matTooltip="Opções dietéticas"
                  matTooltipClass="tavola-tooltip"
                  [matTooltipDisabled]="isMobile">
            <mat-icon>restaurant</mat-icon>
            <span>Opções Dietéticas</span>
            <mat-icon class="chevron">chevron_right</mat-icon>
          </button>
          
          <button mat-icon-button 
                  class="filter-button" 
                  [matMenuTriggerFor]="filterMenu"
                  #filterMenuTrigger="matMenuTrigger"
                  matTooltip="Filtros avançados"
                  matTooltipClass="tavola-tooltip"
                  [matTooltipDisabled]="isMobile">
            <mat-icon>tune</mat-icon>
          </button>
          
          <!-- Menu de filtros -->
          <mat-menu #filterMenu="matMenu" class="tavola-menu-bar" (menuClosed)="onMenuClosed($event)" [hasBackdrop]="true">
            <div class="filter-menu-content" (click)="$event.stopPropagation()" (mousedown)="$event.stopPropagation()">
              <div class="filter-header">
                <h4>Filtros</h4>
                <div class="filter-header-actions">
                  <button mat-icon-button (click)="limparFiltros(); $event.stopPropagation()" matTooltip="Limpar filtros" [matTooltipDisabled]="isMobile">
                    <mat-icon>clear</mat-icon>
                  </button>
                  <button mat-icon-button (click)="filterMenuTrigger.closeMenu(); $event.stopPropagation()" matTooltip="Fechar" [matTooltipDisabled]="isMobile">
                    <mat-icon>close</mat-icon>
                  </button>
                </div>
              </div>
              
              <mat-form-field appearance="outline" class="filter-field">
                <mat-label>Categoria</mat-label>
                <mat-select [(ngModel)]="categoriaFiltro" (selectionChange)="aplicarFiltrosSemFechar()" (click)="$event.stopPropagation()">
                  <mat-option value="">Todas as categorias</mat-option>
                  <mat-option *ngFor="let categoria of categorias" [value]="categoria.nome" (click)="$event.stopPropagation(); $event.preventDefault()">
                    {{ categoria.nome }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              
              <mat-form-field appearance="outline" class="filter-field">
                <mat-label>Tags</mat-label>
                <mat-select [(ngModel)]="tagFiltro" (selectionChange)="aplicarFiltrosSemFechar()" multiple (click)="$event.stopPropagation()">
                  <mat-option *ngFor="let tag of tagsDisponiveis" [value]="tag" (click)="$event.stopPropagation(); $event.preventDefault()">
                    {{ tag }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </mat-menu>
        </div>
      </div>
    </div>
    
    <!-- Navegação de categorias redesenhada com estilo moderno -->
    <div #categoriasNavContainer class="categorias-nav-wrapper" [class.sticky]="categoriasFixas">
      <div class="categorias-nav">
        <button 
          class="nav-arrow left" 
          (click)="scrollCategorias('left')" 
          [class.visible]="mostrarSetaEsquerda">
          <mat-icon>chevron_left</mat-icon>
        </button>
        
        <div class="categorias-scroll" #categoriasScrollContainer (scroll)="onCategoriaScroll($event)">
          <button 
            *ngFor="let categoria of categoriasFiltradas" 
            class="categoria-btn" 
            [class.active]="categoriaAtiva === categoria.nome"
            (click)="selecionarCategoria(categoria.nome)">
            {{ categoria.nome }}
          </button>
        </div>
        
        <button 
          class="nav-arrow right" 
          (click)="scrollCategorias('right')" 
          [class.visible]="mostrarSetaDireita">
          <mat-icon>chevron_right</mat-icon>
        </button>
      </div>
    </div>

    <!-- Grid de itens redesenhado com cards modernos -->
    <nz-image-group>
      <div class="menu-grid">
        <div *ngFor="let categoria of categoriasFiltradas" 
             class="categoria-section" 
             [id]="'categoria-' + categoria.nome.toLowerCase().replace(' ', '-')">
          <div class="categoria-header">
            <h2 class="categoria-titulo">
              <span class="titulo-text">{{ categoria.nome }}</span>
              <span class="titulo-line"></span>
            </h2>
            <span class="categoria-count">{{ categoria.itens.length }} {{ categoria.itens.length === 1 ? 'item' : 'itens' }}</span>
          </div>

          <div class="itens-grid">
            <div *ngFor="let item of categoria.itens" class="item-card">
              <div class="card-image-container">
                <img nz-image [nzSrc]="item.imagem || 'assets/png/placeholder.png'" [alt]="item.nome">
              </div>
              <div class="item-details">
                <div class="item-header">
                  <h3 class="item-nome">{{ item.nome }}</h3>
                  <span class="item-preco">{{ item.preco | currency:'BRL' }}</span>
                </div>
                <p class="item-descricao" *ngIf="item.descricao">{{ item.descricao }}</p>
                <div class="item-tags" *ngIf="item.tags && item.tags.length > 0">
                  <span *ngFor="let tag of item.tags" class="tag-badge">
                    {{ getTagName(tag) }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </nz-image-group>
  </div>
  
  <!-- Mensagem de sem resultados atualizada -->
  <div *ngIf="!isLoading && !hasError && categorias.length > 0 && categoriasFiltradas.length === 0" class="sem-resultados">
    <nz-empty nzNotFoundContent="Nenhum item encontrado com os filtros selecionados.">
      <button nz-empty-footer mat-raised-button color="primary" (click)="limparFiltros()">
        Limpar Filtros
      </button>
    </nz-empty>
  </div>
  
  <!-- Drawer de Opções Dietéticas -->
  <nz-drawer
    [nzVisible]="isDietOptionsVisible"
    nzPlacement="right"
    nzTitle="Opções dietéticas"
    (nzOnClose)="closeDietOptions()"
    [nzWidth]="isMobile ? '60%' : '400px'"
    [nzMaskClosable]="true"
    class="opcoes-dieteticas-drawer-wrapper">
    
    <ng-container *nzDrawerContent>
      <p class="drawer-description">Este restaurante informou-nos que oferece pratos com as seguintes opções dietéticas:</p>
      <div class="opcoes-dieteticas-drawer">
        <div *ngFor="let opcao of dietOptions" class="opcao-item">
          <i nz-icon nzType="check" nzTheme="outline"></i>
          <span>{{ opcao }}</span>
        </div>
      </div>
    </ng-container>
  </nz-drawer>
</div>
