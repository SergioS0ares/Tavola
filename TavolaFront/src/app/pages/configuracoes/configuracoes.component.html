<div class="configuracoes-container">
  <!-- Header usando estilos globais -->
  <div class="tavola-page-header configuracoes">
    <div class="header-content">
      <div class="header-icon">
        <mat-icon>account_circle</mat-icon>
      </div>
      <div class="header-text">
        <h1>Meu Perfil</h1>
        <p>Gerencie suas informações pessoais e de acesso aqui.</p>
      </div>
    </div>
  </div>

  <!-- Seção de Perfil -->
  <mat-card class="profile-card" *ngIf="userData">
    <div class="profile-header">
      <div class="avatar-container">
        <img [src]="userAvatar" alt="Avatar do usuário" class="profile-avatar">
        <button mat-mini-fab class="change-photo-btn" aria-label="Alterar foto" (click)="fileInput.click()">
          <mat-icon>photo_camera</mat-icon>
        </button>
        <input #fileInput type="file" style="display: none" accept="image/*" (change)="onFileSelected($event)">
      </div>
      <div class="profile-info">
        <h2 class="profile-name">{{ userName }}</h2>
        <p class="profile-type">{{ userType }}</p>
        <!-- Adicionado badge de status -->
        <div class="status-badge">
          <mat-icon>verified</mat-icon>
          <span>Conta Ativa</span>
        </div>
      </div>
    </div>
  </mat-card>

  <!-- Informações Pessoais -->
  <mat-card class="info-card" *ngIf="userData">
    <div class="card-header">
      <!-- Adicionado ícone no header do card -->
      <div class="header-with-icon">
        <mat-icon>person</mat-icon>
        <h3>Informações da Conta</h3>
      </div>
      <button mat-icon-button class="edit-icon" *ngIf="!editingInfo" (click)="toggleEditInfo()" aria-label="Editar">
        <mat-icon>edit</mat-icon>
      </button>
    </div>

    <mat-divider></mat-divider>

    <div class="card-content" *ngIf="!editingInfo">
      <!-- Melhorado layout das informações com ícones -->
      <div class="info-row">
        <div class="info-label">
          <mat-icon>badge</mat-icon>
          <span>Nome</span>
        </div>
        <span class="info-value">{{ userData.nome }}</span>
      </div>
      <div class="info-row">
        <div class="info-label">
          <mat-icon>phone</mat-icon>
          <span>Telefone</span>
        </div>
        <span class="info-value">{{ userData.telefone }}</span>
      </div>
    </div>

    <form *ngIf="editingInfo" [formGroup]="infoForm" class="edit-form">
      <mat-form-field appearance="outline">
        <mat-label>Nome</mat-label>
        <input matInput formControlName="nome" type="text">
        <mat-icon matPrefix>badge</mat-icon>
      </mat-form-field>
      
      <mat-form-field appearance="outline">
        <mat-label>Email</mat-label>
        <input matInput formControlName="email" type="email">
        <mat-icon matPrefix>email</mat-icon>
      </mat-form-field>
      
      <mat-form-field appearance="outline">
        <mat-label>Telefone</mat-label>
        <input matInput formControlName="telefone" type="tel" mask="(00) 00000-0000">
        <mat-icon matPrefix>phone</mat-icon>
      </mat-form-field>

      <div class="form-actions">
        <button mat-stroked-button color="warn" (click)="cancelEditInfo()">
          <mat-icon>close</mat-icon>
          Cancelar
        </button>
        <button mat-raised-button class="save-btn" (click)="saveInfo()">
          <mat-icon>save</mat-icon>
          Salvar Alterações
        </button>
      </div>
    </form>
  </mat-card>

  <!-- Endereço -->
  <mat-card class="info-card" *ngIf="userData">
    <div class="card-header">
      <!-- Adicionado ícone no header do card -->
      <div class="header-with-icon">
        <mat-icon>location_on</mat-icon>
        <h3>Endereço</h3>
      </div>
      <button mat-icon-button class="edit-icon" *ngIf="!editingAddress" (click)="toggleEditAddress()" aria-label="Editar">
        <mat-icon>edit</mat-icon>
      </button>
    </div>

    <mat-divider></mat-divider>

    <div class="card-content" *ngIf="!editingAddress">
      <!-- Melhorado layout das informações com ícones -->
      <div class="info-row">
        <div class="info-label">
          <mat-icon>markunread_mailbox</mat-icon>
          <span>CEP</span>
        </div>
        <span class="info-value">{{ userData.endereco?.cep }}</span>
      </div>
      <div class="info-row">
        <div class="info-label">
          <mat-icon>map</mat-icon>
          <span>Estado</span>
        </div>
        <span class="info-value">{{ userData.endereco?.estado }}</span>
      </div>
      <div class="info-row">
        <div class="info-label">
          <mat-icon>location_city</mat-icon>
          <span>Cidade</span>
        </div>
        <span class="info-value">{{ userData.endereco?.cidade }}</span>
      </div>
      <div class="info-row">
        <div class="info-label">
          <mat-icon>home</mat-icon>
          <span>Bairro</span>
        </div>
        <span class="info-value">{{ userData.endereco?.bairro }}</span>
      </div>
      <div class="info-row">
        <div class="info-label">
          <mat-icon>place</mat-icon>
          <span>Endereço</span>
        </div>
        <span class="info-value">{{ userData.endereco?.rua }}, {{ userData.endereco?.numero }}</span>
      </div>
      <div class="info-row" *ngIf="userData.endereco?.complemento">
        <div class="info-label">
          <mat-icon>add_location</mat-icon>
          <span>Complemento</span>
        </div>
        <span class="info-value">{{ userData.endereco?.complemento }}</span>
      </div>
    </div>

    <form *ngIf="editingAddress" [formGroup]="addressForm" class="edit-form">
      <div class="form-grid">
        <mat-form-field appearance="outline">
          <mat-label>CEP</mat-label>
          <input matInput formControlName="cep" type="text" mask="00000-000" (blur)="buscarCep()">
          <mat-icon matPrefix>markunread_mailbox</mat-icon>
          <mat-error *ngIf="mensagemCepInvalido">{{ mensagemCepInvalido }}</mat-error>
        </mat-form-field>
        
        <mat-form-field appearance="outline">
          <mat-label>País</mat-label>
          <input matInput formControlName="pais">
          <mat-icon matPrefix>public</mat-icon>
        </mat-form-field>
      </div>
      
      <div class="form-grid">
        <mat-form-field appearance="outline">
          <mat-label>Estado</mat-label>
          <input matInput formControlName="estado">
          <mat-icon matPrefix>map</mat-icon>
        </mat-form-field>
        
        <mat-form-field appearance="outline">
          <mat-label>Cidade</mat-label>
          <input matInput formControlName="cidade">
          <mat-icon matPrefix>location_city</mat-icon>
        </mat-form-field>
      </div>
      
      <mat-form-field appearance="outline">
        <mat-label>Bairro</mat-label>
        <input matInput formControlName="bairro">
        <mat-icon matPrefix>home</mat-icon>
      </mat-form-field>
      
      <div class="form-grid">
        <mat-form-field appearance="outline" class="rua-field">
          <mat-label>Rua</mat-label>
          <input matInput formControlName="rua">
          <mat-icon matPrefix>place</mat-icon>
        </mat-form-field>
        
        <mat-form-field appearance="outline" class="numero-field">
          <mat-label>Número</mat-label>
          <input matInput formControlName="numero">
          <mat-icon matPrefix>tag</mat-icon>
        </mat-form-field>
      </div>
      
      <mat-form-field appearance="outline">
        <mat-label>Complemento</mat-label>
        <input matInput formControlName="complemento">
        <mat-icon matPrefix>add_location</mat-icon>
      </mat-form-field>

      <div class="form-actions">
        <button mat-stroked-button color="warn" (click)="cancelEditAddress()">
          <mat-icon>close</mat-icon>
          Cancelar
        </button>
        <button mat-raised-button class="save-btn" (click)="saveAddress()">
          <mat-icon>save</mat-icon>
          Salvar Alterações
        </button>
      </div>
    </form>
  </mat-card>

  <!-- Removido card de zona de perigo conforme solicitado -->
  
  <!-- Adicionado spinner global seguindo padrão do histórico -->
  <div *ngIf="loading" class="loading-overlay">
    <app-global-spinner></app-global-spinner>
  </div>
</div>
