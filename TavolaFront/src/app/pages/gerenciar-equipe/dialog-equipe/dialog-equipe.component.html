<div class="dialog-equipe">
  <!-- Estágio 1: Formulário de Cadastro/Edição -->
  <ng-container *ngIf="!dadosGerados">
    <div class="dialog-header">
      <div class="header-content">
        <div class="header-icon">
          <mat-icon>{{ data.editMode ? 'edit' : 'person_add' }}</mat-icon>
        </div>
        <div class="header-text">
          <h2 mat-dialog-title>{{ data.editMode ? 'Editar Membro' : 'Adicionar Novo Membro' }}</h2>
          <p class="header-subtitle">
            {{ data.editMode ? 'Atualize as informações do membro' : 'Preencha os dados para gerar o código de acesso' }}
          </p>
        </div>
      </div>
      <button mat-icon-button mat-dialog-close class="close-btn" aria-label="Fechar diálogo">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <div mat-dialog-content class="dialog-content">
      <form [formGroup]="form" class="form-container">
        <div class="form-field">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Nome Completo</mat-label>
            <input matInput formControlName="nome" placeholder="Digite o nome completo" required>
            <mat-error *ngIf="form.get('nome')?.hasError('required')">
              Nome é obrigatório
            </mat-error>
            <mat-error *ngIf="form.get('nome')?.hasError('minlength')">
              Nome deve ter pelo menos 3 caracteres
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-field">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Senha Provisória</mat-label>
            <input 
              matInput 
              [type]="hidePassword ? 'password' : 'text'" 
              formControlName="senha" 
              placeholder="Digite uma senha segura"
              required>
            <button 
              mat-icon-button 
              matSuffix 
              (click)="hidePassword = !hidePassword"
              type="button"
              [attr.aria-label]="'Mostrar/ocultar senha'">
              <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>
            <mat-error *ngIf="form.get('senha')?.hasError('required')">
              Senha é obrigatória
            </mat-error>
            <mat-error *ngIf="form.get('senha')?.hasError('minlength')">
              Senha deve ter pelo menos 6 caracteres
            </mat-error>
          </mat-form-field>
        </div>
      </form>
    </div>

    <div mat-dialog-actions class="dialog-actions">
      <button 
        mat-button 
        (click)="fechar()" 
        [disabled]="carregando"
        class="cancel-btn">
        <mat-icon>close</mat-icon>
        Cancelar
      </button>
      <button 
        mat-raised-button 
        color="primary" 
        (click)="salvar()" 
        [disabled]="form.invalid || carregando"
        class="submit-btn">
        <mat-icon *ngIf="carregando" class="loading-icon">hourglass_empty</mat-icon>
        <mat-icon *ngIf="!carregando">{{ data.editMode ? 'save' : 'vpn_key' }}</mat-icon>
        {{ carregando ? 'Processando...' : (data.editMode ? 'Salvar Alterações' : 'Gerar Código') }}
      </button>
    </div>
  </ng-container>

  <!-- Estágio 2: Confirmação e Exibição do Código -->
  <ng-container *ngIf="dadosGerados">
    <div class="dialog-header success">
      <div class="header-content">
        <div class="header-icon success">
          <mat-icon>check_circle</mat-icon>
        </div>
        <div class="header-text">
          <h2 mat-dialog-title>Membro Adicionado!</h2>
          <p class="header-subtitle">Guarde os dados de acesso para compartilhar</p>
        </div>
      </div>
    </div>

    <div mat-dialog-content class="dialog-content success">
      <div class="resultado-container">
        <div class="membro-info">
          <div class="membro-avatar">
            <img [src]="getImagemUrl(null)" alt="Avatar Padrão">
          </div>
          <h3 class="membro-nome">{{ dadosGerados.nome }}</h3>
        </div>

        <div class="dados-acesso">
          <div class="dado-item">
            <div class="dado-header">
              <mat-icon>vpn_key</mat-icon>
              <span>Código de Acesso</span>
            </div>
            <div class="dado-content">
              <span class="codigo-value">{{ formatarCodigo(dadosGerados.codigo) }}</span>
              <button 
                mat-icon-button 
                (click)="copiar(dadosGerados.codigo)"
                class="copy-btn"
                matTooltip="Copiar código">
                <mat-icon>content_copy</mat-icon>
              </button>
            </div>
          </div>

          <div class="dado-item">
            <div class="dado-header">
              <mat-icon>lock</mat-icon>
              <span>Senha Provisória</span>
            </div>
            <div class="dado-content">
              <span class="senha-value">{{ dadosGerados.senha }}</span>
              <button 
                mat-icon-button 
                (click)="copiar(dadosGerados.senha)"
                class="copy-btn"
                matTooltip="Copiar senha">
                <mat-icon>content_copy</mat-icon>
              </button>
            </div>
          </div>
        </div>

        <div class="aviso-seguranca">
          <mat-icon class="warning-icon">warning</mat-icon>
          <div class="aviso-text">
            <strong>Atenção:</strong> A senha não será mostrada novamente. 
            Compartilhe os dados de forma segura com o funcionário.
          </div>
        </div>
      </div>
    </div>

    <div mat-dialog-actions class="dialog-actions">
      <button 
        mat-raised-button 
        color="primary" 
        (click)="fechar()"
        class="close-btn">
        <mat-icon>check</mat-icon>
        Fechar
      </button>
    </div>
  </ng-container>
</div>
