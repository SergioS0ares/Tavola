<div class="equipe-container">
  <!-- Cabeçalho da Página usando estilos globais -->
  <div class="tavola-page-header equipe">
    <div class="header-content">
      <div class="header-icon">
        <mat-icon>groups</mat-icon>
      </div>
      <div class="header-text">
        <h1>Minha Equipe</h1>
        <p>Adicione e gerencie os códigos de acesso dos seus funcionários.</p>
      </div>
    </div>
  </div>

  <!-- Estado de Carregamento -->
  <div *ngIf="carregando" class="loading-state">
    <div class="loading-spinner">
      <mat-icon>hourglass_empty</mat-icon>
    </div>
    <p>Carregando equipe...</p>
  </div>

  <!-- Campo de Busca -->
  <div *ngIf="!carregando && equipe.length > 0" class="search-section">
    <div class="search-container">
      <mat-form-field appearance="outline" class="tavola-search-field">
        <mat-label>Buscar membro da equipe</mat-label>
        <input matInput 
          [(ngModel)]="pesquisa" 
          (input)="aplicarFiltros()"
          placeholder="Digite o nome do funcionário">
        <button mat-icon-button matSuffix *ngIf="pesquisa" (click)="limparPesquisa()" aria-label="Limpar pesquisa">
          <mat-icon>close</mat-icon>
        </button>
        <button mat-icon-button matSuffix *ngIf="!pesquisa" aria-label="Buscar">
          <mat-icon>search</mat-icon>
        </button>
      </mat-form-field>
    </div>
  </div>

  <!-- Lista de Membros -->
  <div *ngIf="!carregando && equipeFiltrada.length > 0" class="equipe-list">
    <mat-card *ngFor="let membro of equipeFiltrada; trackBy: trackByMembroId" class="membro-card">
      
      <div class="membro-content">
        <!-- Botão de ações mobile no canto superior direito -->
        <button 
          mat-icon-button 
          [matMenuTriggerFor]="menu"
          #memberMenuTriggerMobile="matMenuTrigger"
          class="actions-btn-mobile"
          matTooltip="Ações"
          matTooltipClass="tavola-tooltip"
          [matTooltipDisabled]="isMobile"
          aria-label="Ações do membro">
          <mat-icon>more_vert</mat-icon>
        </button>
        
        <div class="membro-info">
          <div class="avatar-container">
            <img [src]="getImagemUrl(membro.imagem ?? membro.imagem ?? null)" [alt]="'Avatar de ' + membro.nome" class="profile-avatar">
            <button 
              mat-mini-fab 
              class="change-photo-btn"
              (click)="trocarImagem(membro)"
              matTooltip="Alterar foto do membro"
              matTooltipClass="tavola-tooltip"
              [matTooltipDisabled]="isMobile"
              aria-label="Alterar foto">
              <mat-icon>photo_camera</mat-icon>
            </button>
          </div>
          <div class="membro-details">
            <h3 class="membro-nome">{{ membro.nome }}</h3>
            <div class="membro-codigo">
              <span class="codigo-label">Código de Acesso:</span>
              <div class="codigo-container">
                <span class="codigo-value">{{ formatarCodigo(membro.codigo) }}</span>
                <button 
                  mat-icon-button 
                  class="copy-btn tavola-copy-btn" 
                  [class.copied]="copiadoMembros[membro.id]"
                  (click)="copiarCodigo(membro.codigo, membro.id)"
                  [matTooltip]="copiadoMembros[membro.id] ? 'Código copiado!' : 'Copiar código'"
                  matTooltipClass="tavola-tooltip"
                  [matTooltipDisabled]="isMobile"
                  aria-label="Copiar código de acesso">
                  <mat-icon>{{ copiadoMembros[membro.id] ? 'check' : 'content_copy' }}</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Botão de ações no desktop -->
        <div class="membro-actions">
          <button 
            mat-icon-button 
            [matMenuTriggerFor]="menu"
            #memberMenuTriggerDesktop="matMenuTrigger"
            class="actions-btn actions-btn-desktop"
            matTooltip="Ações"
            matTooltipClass="tavola-tooltip"
            [matTooltipDisabled]="isMobile"
            aria-label="Ações do membro">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #menu="matMenu" class="tavola-menu-bar" (menuClosed)="onMenuClosed($event)">
            <button mat-menu-item (click)="abrirDialogEdicao(membro)">
              <mat-icon>edit</mat-icon>
              <span>Editar</span>
            </button>
            <button mat-menu-item (click)="removerMembro(membro)" class="delete-action">
              <mat-icon>delete</mat-icon>
              <span>Remover</span>
            </button>
          </mat-menu>
        </div>
      </div>
    </mat-card>
  </div>
  
  <!-- Estado Vazio -->
  <div *ngIf="!carregando && equipe.length === 0" class="empty-state">
    <div class="empty-icon">
      <mat-icon>group_add</mat-icon>
    </div>
    <h3>Nenhum membro na equipa</h3>
    <p>Comece por adicionar o seu primeiro funcionário.</p>
    <button mat-raised-button color="primary" (click)="abrirDialogAdicao()">
      <mat-icon>person_add</mat-icon>
      Adicionar Primeiro Membro
    </button>
  </div>

  <!-- Estado de busca sem resultados -->
  <div *ngIf="!carregando && equipe.length > 0 && equipeFiltrada.length === 0 && pesquisa.trim() !== ''" class="tavola-empty-search">
    <div class="empty-icon">
      <mat-icon>search_off</mat-icon>
    </div>
    <h3>Nenhum membro encontrado</h3>
    <p>Não encontramos nenhum funcionário com o nome "{{ pesquisa }}"</p>
    <button mat-raised-button color="primary" (click)="limparPesquisa()">
      <mat-icon>refresh</mat-icon>
      Limpar busca
    </button>
  </div>

  <!-- Botão Flutuante de Adicionar -->
  <button 
    *ngIf="equipe.length > 0"
    mat-fab 
    color="primary" 
    class="tavola-fab" 
    (click)="abrirDialogAdicao()"
    matTooltip="Adicionar novo membro"
    matTooltipClass="tavola-tooltip"
    [matTooltipDisabled]="isMobile"
    aria-label="Adicionar novo membro">
    <mat-icon>add</mat-icon>
  </button>
</div>
