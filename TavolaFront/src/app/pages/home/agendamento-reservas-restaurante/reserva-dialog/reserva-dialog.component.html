<div class="card-reserva-tavola card-reserva-dialog">
  <!-- Cabeçalho estilo Tavola -->
  <div class="cabecalho-reserva">
    <h2 class="titulo-reserva">Reserve uma mesa</h2>
    <p class="texto-gratis">Grátis</p>
    <button mat-icon-button (click)="fechar()" class="fechar-dialog-btn">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Navegação Horizontal estilo Tavola -->
  <div class="navegacao-reserva">
    <button 
      class="etapa-nav" 
      [class.active]="bookingStep === 1" 
      [class.completed]="bookingStep > 1"
      (click)="setBookingStep(1)">
      <div class="conteudo-etapa">
        <i nz-icon nzType="calendar" nzTheme="outline"></i>
        <span>{{ bookingStep > 1 ? getFormattedDate() : 'Data' }}</span>
      </div>
    </button>
    
    <button 
      class="etapa-nav" 
      [class.active]="bookingStep === 2" 
      [class.completed]="bookingStep > 2"
      [disabled]="bookingStep < 2"
      (click)="setBookingStep(2)">
      <div class="conteudo-etapa">
        <i nz-icon nzType="clock-circle" nzTheme="outline"></i>
        <span>{{ bookingStep > 2 ? selectedTime : 'Horário' }}</span>
      </div>
    </button>
    
    <button 
      class="etapa-nav" 
      [class.active]="bookingStep === 3" 
      [class.completed]="bookingStep > 3"
      [disabled]="bookingStep < 3"
      (click)="setBookingStep(3)">
      <div class="conteudo-etapa">
        <nz-icon nzType="team" nzTheme="outline" />
        <span>{{ bookingStep > 3 ? selectedGuests + ' pessoas' : 'Pessoas' }}</span>
      </div>
    </button>
    
    <button 
      class="etapa-nav" 
      [class.active]="bookingStep === 4" 
      [class.completed]="bookingStep > 4"
      [disabled]="bookingStep < 4"
      (click)="setBookingStep(4)">
      <div class="conteudo-etapa">
        <nz-icon nzType="check-circle" nzTheme="outline" />
        <span>Confirmar</span>
      </div>
    </button>
  </div>

  <!-- Container de Conteúdo com Scroll -->
  <div class="conteudo-reserva">
    <!-- Etapa 1: Seleção de Data -->
    <div *ngIf="bookingStep === 1" class="etapa-reserva">
      <nz-calendar 
        *ngIf="!isLoading"
        [(ngModel)]="selectedDate" 
        [nzDisabledDate]="disabledDate"
        (nzSelectChange)="onDateSelect($event)"
        nzMode="month"
        class="calendario-tavola">
      </nz-calendar>
    </div>

    <!-- Etapa 2: Seleção de Horário -->
    <div *ngIf="bookingStep === 2" class="etapa-reserva">
      <div class="cabecalho-etapa">
        <button nz-button nzType="text" (click)="goBackStep()" class="botao-voltar">
          <i nz-icon nzType="left" nzTheme="outline"></i>
        </button>
        <h3>Escolha seu horário</h3>
      </div>

      <div *ngFor="let period of availableSlots" class="periodo-horario">
        <h4>{{ period.period }}</h4>
        <div class="slots-horario">
          <button 
            *ngFor="let slot of period.slots" 
            nz-button 
            [nzType]="slot.availability === 'available' ? 'default' : 'dashed'"
            [disabled]="slot.availability === 'unavailable'"
            class="slot-horario"
            [class.limitado]="slot.availability === 'limited'"
            (click)="onTimeSelect(slot.time)">
            {{ slot.time }}
            <span *ngIf="slot.percentage" class="percentual">{{ slot.percentage }}%</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Etapa 3: Seleção de Pessoas -->
    <div *ngIf="bookingStep === 3" class="etapa-reserva">
      <div class="cabecalho-etapa">
        <button nz-button nzType="text" (click)="goBackStep()" class="botao-voltar">
          <i nz-icon nzType="left" nzTheme="outline"></i>
        </button>
        <h3>Número de pessoas</h3>
      </div>

      <div class="grid-pessoas">
        <button 
          *ngFor="let num of [1,2,3,4,5,6,7,8,9,10,11,12]" 
          nz-button 
          nzType="default"
          class="botao-pessoa"
          [class.selecionado]="selectedGuests === num"
          (click)="onGuestsSelect(num)">
          {{ num }}
        </button>
      </div>
    </div>

    <!-- Etapa 4: Confirmação e Comentários -->
    <div *ngIf="bookingStep === 4" class="etapa-reserva">
      <div class="cabecalho-etapa">
        <button nz-button nzType="text" (click)="goBackStep()" class="botao-voltar">
          <i nz-icon nzType="left" nzTheme="outline"></i>
        </button>
        <h3>Confirmar Reserva</h3>
      </div>

      <!-- Resumo da Reserva -->
      <div class="resumo-reserva">
        <h4>Resumo da sua reserva</h4>
        <div class="resumo-item">
          <span class="label">Restaurante:</span>
          <span class="value">{{ bookingData?.restaurant }}</span>
        </div>
        <div class="resumo-item">
          <span class="label">Data:</span>
          <span class="value">{{ bookingData?.formattedDate }}</span>
        </div>
        <div class="resumo-item">
          <span class="label">Horário:</span>
          <span class="value">{{ bookingData?.time }}</span>
        </div>
        <div class="resumo-item">
          <span class="label">Pessoas:</span>
          <span class="value">{{ bookingData?.guests }} {{ bookingData?.guests === 1 ? 'pessoa' : 'pessoas' }}</span>
        </div>
      </div>

      <!-- Campo de Comentários -->
      <div class="comentarios-section">
        <h4>Comentários ou preferências especiais</h4>
        <p class="comentarios-desc">Adicione qualquer informação que possa nos ajudar a tornar sua experiência ainda melhor.</p>
        
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Comentários</mat-label>
          <textarea
            matInput
            [(ngModel)]="selectedComments"
            placeholder="Ex: Mesa perto da janela, aniversário, alergias alimentares..."
            rows="3"
            maxlength="200"
          ></textarea>
          <mat-hint align="end">{{ selectedComments.length }}/200</mat-hint>
        </mat-form-field>

        <!-- Sugestões rápidas -->
        <div class="sugestoes-rapidas">
          <span class="sugestoes-label">Sugestões rápidas:</span>
          <div class="sugestoes-chips">
            <button 
              *ngFor="let sugestao of ['Mesa perto da janela', 'É aniversário', 'Mesa mais reservada', 'Primeira visita']"
              nz-button 
              nzType="dashed" 
              nzSize="small"
              class="sugestao-chip"
              (click)="selectedComments = selectedComments ? selectedComments + ', ' + sugestao : sugestao">
              {{ sugestao }}
            </button>
          </div>
        </div>
      </div>

      <!-- Botão de Confirmação -->
      <div class="confirmacao-section">
        <button
          mat-raised-button
          color="primary"
          class="botao-confirmar mat-rounded-button"
          (click)="confirmar()">
          <mat-icon>check</mat-icon>
          Confirmar Reserva
        </button>
      </div>
    </div>
  </div>
</div>


