<div class="banner" #banner>
  <div class="banner-content">
    <div class="banner-row">
      <!-- Reordered for mobile: pizza first, then text, then search -->
      <div class="banner-right">
        <img src="assets/png/Pizza.png" alt="Pizza" class="pizza-img" />
      </div>
      
      <div class="banner-left">
        <h1>Descubra e reserve o melhor restaurante</h1>
        
        <div #searchSentinel style="height: 1px; width: 100%; margin-bottom: 1px; background: transparent;"></div>
        
        <div class="search-wrapper" [style.visibility]="stickySearch ? 'hidden' : 'visible'">
          <app-search-bar
            #searchBarHome
            [citySuggestions]="filteredCitySuggestions"
            [querySuggestions]="querySuggestions"
            [showCityDropdown]="showCityDropdown"
            [showQueryDropdown]="showQueryDropdown"
            [cityCtrl]="cityCtrl"
            [queryCtrl]="queryCtrl"
            [filteredCities$]="filteredCities$"
            [filteredQueries$]="filteredQueries$"
            (search)="onSearch()"
            (cityInput)="onCityInput($event)"
            (selectCity)="selectCity($event)"
            (selectQuery)="selectQuery($event)"
            (cityBlur)="onCityBlur($event)"
            (filtrosClick)="abrirDialogFiltros()"
          ></app-search-bar>
          
          <!-- Dropdown da cidade posicionado relativo ao search-wrapper -->
          <div class="city-dropdown-absolute" *ngIf="showCityDropdown">
            <div class="dropdown city-dropdown">
              <input class="dropdown-city-search" type="text" placeholder="Digite a cidade..." [formControl]="cityCtrl" (input)="onCityInput($event)" autofocus>
              <div class="dropdown-item brown-text highlight" (mousedown)="selectCity('Perto de mim')">
                <mat-icon class="icon brown">send</mat-icon> Perto de mim
              </div>
              <div class="dropdown-title">Sugestões</div>
              <div class="dropdown-item brown-text" *ngFor="let city of filteredCitySuggestions" (mousedown)="selectCity(city)">
                <mat-icon class="icon brown">location_on</mat-icon> {{city}}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="restaurants-section" [class.sidebar-aberta]="isSidebarOpen">
  <!-- Estado de busca vazia -->
  <div *ngIf="fezBusca && !buscando && restaurants.length === 0" class="tavola-empty-search">
    <div class="empty-icon">
      <mat-icon>search_off</mat-icon>
    </div>
    <h3>Nenhum restaurante encontrado</h3>
    <p>Não encontramos nenhum restaurante com os critérios selecionados.</p>
    <button mat-raised-button color="primary" (click)="limparBusca()">
      <mat-icon>refresh</mat-icon>
      Limpar busca
    </button>
  </div>

  <!-- Estado de carregamento da busca -->
  <div *ngIf="buscando" class="loading-state">
    <div class="loading-spinner">
      <mat-icon>hourglass_empty</mat-icon>
    </div>
    <p>Buscando restaurantes...</p>
  </div>

  <!-- Lista de restaurantes agrupados por cozinha -->
  <div *ngIf="!buscando && restaurants.length > 0">
    <div *ngFor="let cuisine of getCuisineTypes()" class="cuisine-group">
      <div class="cuisine-header">
        <h2>{{ cuisine }}</h2>
        <div class="navigation-arrows">
          <button mat-icon-button (click)="scrollRestaurants(cuisine, 'left')" [disabled]="!canScrollLeft(cuisine)">
            <mat-icon>chevron_left</mat-icon>
          </button>
          <button mat-icon-button (click)="scrollRestaurants(cuisine, 'right')" [disabled]="!canScrollRight(cuisine)">
            <mat-icon>chevron_right</mat-icon>
          </button>
        </div>
      </div>

      <div class="scrollable-restaurants" #scrollContainer [attr.data-cuisine]="cuisine" (scroll)="onRestaurantScroll($event, cuisine)">
        <div class="restaurants-grid">
          <div class="restaurant-card" *ngFor="let r of groupedRestaurants[cuisine]" [routerLink]="['/home','agendamento-reservas-restaurante', r.id]">
            <div class="card-image-container">
              <img [src]="getImagemRestaurante(r)" [alt]="r.nome" class="restaurant-img" />
            </div>
            <div class="restaurant-info card-content">
              <div class="restaurant-name">{{ r.nome }}</div>
              <div class="restaurant-address">
                <mat-icon>location_on</mat-icon>
                {{ getEnderecoFormatado(r) }}
              </div>
              <div class="info-row">
                <div class="rating-section">
                  <mat-icon class="star-icon">star</mat-icon>
                  <span>{{ r.mediaAvaliacao.toFixed(1) }}</span>
                  <span class="reviews-count" *ngIf="getTotalAvaliacoes(r) > 0">({{ getTotalAvaliacoes(r) }} avaliações)</span>
                </div>
                <mat-chip-listbox *ngIf="r.tipoCozinha">
                  <mat-chip>{{ r.tipoCozinha }}</mat-chip>
                </mat-chip-listbox>
              </div>
              <div class="preco-section" *ngIf="r.valorMedioPorPessoa">
                <mat-icon>attach_money</mat-icon>
                <span>{{ getPrecoMedio(r.valorMedioPorPessoa) }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Estado inicial (sem busca) -->
  <div *ngIf="!fezBusca && !buscando && restaurants.length === 0" class="initial-state">
    <div class="initial-icon">
      <mat-icon>restaurant</mat-icon>
    </div>
    <h3>Descubra os melhores restaurantes</h3>
    <p>Use a barra de pesquisa acima para encontrar restaurantes por cidade, nome ou tipo de cozinha.</p>
  </div>
</div>