<div class="tavola-dialog">
  <div class="dialog-container">
    <div class="dialog-header">
      <div class="header-icon">
        <mat-icon>table_restaurant</mat-icon>
      </div>
      <h1 mat-dialog-title>Mesa {{ data.mesa.nome }}</h1>
      <p class="subtitle">Detalhes e informações da mesa</p>
      <button mat-icon-button (click)="fechar()" class="close-button">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    
    <mat-dialog-content class="dialog-content">
      <div class="mesa-info">
        <div class="info-item">
          <mat-icon>group</mat-icon>
          <div class="info-text">
            <span class="label">Capacidade</span>
            <span class="value">{{ data.mesa.capacidade }} Pessoas</span>
          </div>
        </div>
        <div class="info-item">
          <mat-icon>toggle_on</mat-icon>
          <div class="info-text">
            <span class="label">Status</span>
            <span class="value">{{ getStatusText(data.mesa.status) }}</span>
          </div>
        </div>
        
        <!-- Tempo de ocupação -->
        <div class="info-item" *ngIf="data.mesa.inicioOcupacao">
          <mat-icon>schedule</mat-icon>
          <div class="info-text">
            <span class="label">Tempo ocupada</span>
            <span class="value tempo-chip">{{ data.mesa.tempoOcupacaoDisplay || 'Calculando...' }}</span>
          </div>
        </div>
        
        <div class="info-item" *ngIf="data.mesa.reserva">
          <mat-icon>event</mat-icon>
          <div class="info-text">
            <span class="label">Reserva</span>
            <span class="value">
              {{ data.mesa.reserva.cliente }} - {{ data.mesa.reserva.horario }} ({{data.mesa.reserva.pessoas}}p)
            </span>
          </div>
        </div>
        
        <!-- Nome do cliente quando a mesa foi ocupada ou está em atendimento -->
        <div class="info-item" *ngIf="data.mesa.clienteNome && (data.mesa.status === 'OCUPADA' || data.mesa.status === 'EM_ATENDIMENTO')">
          <mat-icon>person</mat-icon>
          <div class="info-text">
            <span class="label">Cliente</span>
            <span class="value">{{ data.mesa.clienteNome }}</span>
          </div>
        </div>
      </div>
      
      <div class="garcoms-atendendo" *ngIf="data.mesa.garcomsAtendendo && data.mesa.garcomsAtendendo.length > 0">
        <h4>Garçons Atendendo</h4>
        <div class="garcoms-list">
          <div *ngFor="let garcomId of data.mesa.garcomsAtendendo" class="garcom-item">
            <nz-avatar [nzSize]="32" [nzSrc]="getGarcomInfo(garcomId)?.foto || 'assets/png/avatar-padrao-garcom-tavola.png'" nzIcon="person"></nz-avatar>
            <span>{{ getGarcomInfo(garcomId)?.nome || 'Garçom ' + garcomId }}</span> 
            <button mat-icon-button 
                    color="warn" 
                    class="remove-garcom-btn" 
                    (click)="removerGarcom(garcomId)"
                    matTooltip="Remover este garçom da mesa">
              <mat-icon>close</mat-icon>
            </button>
          </div>
        </div>
      </div>

      <!-- Dropdown para adicionar garçons específicos -->
      <div class="adicionar-garcom-section" *ngIf="data.mesa.status === 'EM_ATENDIMENTO' && garconsParaAdicionar.length > 0">
        <h4>Adicionar Garçom</h4>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Selecionar garçom</mat-label>
          <mat-select (selectionChange)="adicionarGarcomSelecionado($event.value)">
            <mat-option *ngFor="let garcom of garconsParaAdicionar" [value]="garcom.id">
              <div style="display: flex; align-items: center; gap: 8px;">
                <nz-avatar [nzSize]="24" [nzSrc]="garcom.foto || 'assets/png/avatar-padrao-garcom-tavola.png'" nzIcon="person"></nz-avatar>
                <span>{{ garcom.nome }}</span>
              </div>
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      
          <div class="mesa-actions">
            
            <!-- Input para nome do cliente (aparece quando clica em ocupar mesa) -->
            <div class="input-cliente-section" *ngIf="mostrandoInputCliente && data.mesa.status === 'LIVRE'">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Nome do Cliente</mat-label>
                <input matInput [(ngModel)]="nomeCliente" placeholder="Digite o nome do cliente" (keyup.enter)="ocuparMesa()" maxlength="100">
                <mat-hint align="end">{{ nomeCliente.length }}/100</mat-hint>
              </mat-form-field>
              
              <!-- Sugestões rápidas -->
              <div class="sugestoes-rapidas">
                <span class="sugestoes-label">Sugestões rápidas:</span>
                <div class="sugestoes-chips">
                  <button 
                    *ngFor="let sugestao of sugestoesNomesClientes"
                    nz-button 
                    nzType="dashed" 
                    nzSize="small"
                    class="sugestao-chip"
                    (click)="adicionarSugestao(sugestao)">
                    {{ sugestao }}
                  </button>
                </div>
              </div>
              
              <div class="input-actions">
                <button mat-stroked-button (click)="cancelarOcupacao()" class="cancel-btn">
                  <mat-icon>close</mat-icon>
                  Cancelar
                </button>
                <button mat-raised-button (click)="ocuparMesa()" class="confirm-btn">
                  <mat-icon>check</mat-icon>
                  Confirmar
                </button>
              </div>
            </div>

            <!-- Botão para ocupar mesa livre -->
            <button mat-raised-button 
                    (click)="ocuparMesa()" 
                    *ngIf="data.mesa.status === 'LIVRE' && !mostrandoInputCliente"
                    class="ocupar-mesa-btn">
              <mat-icon>person_add</mat-icon>
              Ocupar Mesa
            </button>
            
            <!-- Botão para iniciar atendimento -->
            <button mat-raised-button 
                    (click)="executarAcaoPrincipal()" 
                    *ngIf="data.mesa.status === 'OCUPADA' || data.mesa.status === 'RESERVADA'"
                    class="iniciar-atendimento-btn">
              <mat-icon>restaurant</mat-icon>
              Iniciar Atendimento
            </button>
            
            <!-- Ações para mesa em atendimento -->
            <ng-container *ngIf="data.mesa.status === 'EM_ATENDIMENTO'">
              <button mat-raised-button (click)="verCardapio()">
                <mat-icon>restaurant_menu</mat-icon>
                Ver Cardápio / Pedido
              </button>
              <button mat-stroked-button class="warn" (click)="liberarMesa()">
                <mat-icon>event_available</mat-icon>
                Liberar Mesa
              </button>
            </ng-container>
            
          </div>
    </mat-dialog-content>
  </div>
</div>
